{% extends 'base.html' %}

{% block title %}Chi tiết đơn đặt sân - CourtMaster{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="bg-gradient-to-br from-green-50 to-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <div class="inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium mb-4">
                <i class="fas fa-file-alt mr-2"></i>
                Chi tiết đơn đặt sân
            </div>
            <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-4">Đơn đặt sân #{{ booking.pk }}</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">Tạo ngày: {{ booking.created_at|date:"d/m/Y H:i" }}</p>
        </div>
    </div>
</div>

<!-- Booking Detail Section -->
<div class="py-20 bg-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
            <!-- Status Header -->
            <div class="bg-gradient-to-r from-green-500 to-green-600 px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-2">Trạng thái đơn đặt</h2>
                        <p class="text-green-100">Theo dõi trạng thái đơn đặt sân của bạn</p>
                    </div>
                    <div class="text-right">
                        <span class="px-6 py-3 rounded-full text-lg font-semibold inline-block
                            {% if booking.status == 'pending' %}bg-yellow-100 text-yellow-800
                            {% elif booking.status == 'confirmed' %}bg-green-100 text-green-800
                            {% elif booking.status == 'completed' %}bg-blue-100 text-blue-800
                            {% else %}bg-red-100 text-red-800{% endif %}">
                            <i class="fas {% if booking.status == 'pending' %}fa-clock{% elif booking.status == 'confirmed' %}fa-check-circle{% elif booking.status == 'completed' %}fa-flag-checkered{% else %}fa-times-circle{% endif %} mr-2"></i>
                            {{ booking.get_status_display }}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-8">
                <!-- Booking Information Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Court Information -->
                    <div class="bg-gray-50 rounded-2xl p-6">
                        <h3 class="font-bold text-gray-900 mb-4 text-lg flex items-center">
                            <i class="fas fa-map-marker-alt text-green-600 mr-3"></i>
                            Thông tin sân
                        </h3>
                        <div class="space-y-3 text-gray-700">
                            <div class="flex justify-between">
                                <span class="font-medium">Sân:</span>
                                <span>{{ booking.court.name }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium">Ngày:</span>
                                <span>{{ booking.date|date:"d/m/Y" }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium">Số giờ:</span>
                                <span>{{ booking.total_hours }} giờ</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Time Slots -->
                    <div class="bg-gray-50 rounded-2xl p-6">
                        <h3 class="font-bold text-gray-900 mb-4 text-lg flex items-center">
                            <i class="fas fa-clock text-green-600 mr-3"></i>
                            Khung giờ đã đặt
                        </h3>
                        <div class="flex flex-wrap gap-2">
                            {% for slot in booking.time_slots.all %}
                            <span class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium">
                                {{ slot.get_time_display }}
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Payment Information -->
                <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-2xl p-6 mb-8 border border-green-200">
                    <h3 class="font-bold text-gray-900 mb-4 text-lg flex items-center">
                        <i class="fas fa-money-bill-wave text-green-600 mr-3"></i>
                        Thông tin thanh toán
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-1">Giá mỗi giờ</p>
                            <p class="text-lg font-semibold text-gray-900">{{ booking.court.price_per_hour|floatformat:0 }}₫</p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-1">Số giờ</p>
                            <p class="text-lg font-semibold text-gray-900">{{ booking.total_hours }} giờ</p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-1">Tổng tiền</p>
                            <p class="text-2xl font-bold text-green-600">{{ booking.total_price|floatformat:0 }}₫</p>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Proof -->
                {% if booking.payment_proof %}
                <div class="mb-8">
                    <h3 class="font-bold text-gray-900 mb-4 text-lg flex items-center">
                        <i class="fas fa-receipt text-green-600 mr-3"></i>
                        Minh chứng thanh toán
                    </h3>
                    <div class="bg-gray-50 rounded-2xl p-6">
                        <img src="{{ booking.payment_proof.url }}" alt="Minh chứng thanh toán" class="max-w-md rounded-lg shadow-lg border border-gray-200 mx-auto">
                    </div>
                    
                    <!-- Upload Status -->
                    {% if booking.status == 'pending' %}
                    <div class="mt-4 bg-blue-50 border border-blue-200 rounded-2xl p-4">
                        <div class="flex items-center">
                            <i class="fas fa-clock text-blue-600 text-xl mr-3"></i>
                            <div>
                                <h4 class="font-semibold text-blue-800">Đang chờ xác nhận</h4>
                                <p class="text-blue-700 text-sm">Minh chứng thanh toán đã được upload. Vui lòng chờ admin xác nhận.</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% elif not booking.payments.exists %}
                <div class="bg-yellow-50 border border-yellow-200 rounded-2xl p-6 mb-8">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 text-xl mr-3"></i>
                        <div>
                            <h4 class="font-semibold text-yellow-800">Chưa upload minh chứng thanh toán</h4>
                            <p class="text-yellow-700 text-sm">Vui lòng upload minh chứng thanh toán để đơn đặt được xác nhận</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Notes -->
                {% if booking.notes %}
                <div class="mb-8">
                    <h3 class="font-bold text-gray-900 mb-4 text-lg flex items-center">
                        <i class="fas fa-sticky-note text-green-600 mr-3"></i>
                        Ghi chú
                    </h3>
                    <div class="bg-gray-50 rounded-2xl p-6">
                        <p class="text-gray-700">{{ booking.notes }}</p>
                    </div>
                </div>
                {% endif %}
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                    <!-- Payment Button - Only show if no payment proof uploaded, no paid payment, and no VNPay payment -->
                    {% if booking.status == 'pending' and not booking.payment_proof and not booking.has_paid_payment and not booking.payments.exists %}
                    <a href="{% url 'payment:payment_method_selection' booking.id %}" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-6 py-4 rounded-lg font-semibold transition shadow-lg text-center">
                        <i class="fas fa-credit-card mr-2"></i>
                        Thanh toán
                    </a>
                    {% elif booking.has_paid_payment %}
                    <a href="{% url 'payment:payment_detail' booking.payments.first.id %}" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-6 py-4 rounded-lg font-semibold transition shadow-lg text-center">
                        <i class="fas fa-receipt mr-2"></i>
                        Xem hóa đơn
                    </a>
                    {% elif booking.payments.exists %}
                    <a href="{% url 'payment:payment_detail' booking.payments.first.id %}" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-6 py-4 rounded-lg font-semibold transition shadow-lg text-center">
                        <i class="fas fa-credit-card mr-2"></i>
                        Xem thanh toán
                    </a>
                    {% endif %}
                    
                    <!-- Upload Button - Only show if no payment proof uploaded, no paid payment, and no VNPay payment -->
                    {% if booking.status == 'pending' and not booking.payment_proof and not booking.has_paid_payment and not booking.payments.exists %}
                    <a href="{% url 'booking:booking_upload_payment' booking.pk %}" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-4 rounded-lg font-semibold transition shadow-lg text-center">
                        <i class="fas fa-upload mr-2"></i>
                        Upload minh chứng
                    </a>
                    {% endif %}
                    
                    <!-- Cancel Button -->
                    {% if booking.status == 'pending' or booking.status == 'confirmed' %}
                    <a href="{% url 'booking:booking_cancel' booking.pk %}" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-6 py-4 rounded-lg font-semibold transition shadow-lg text-center">
                        <i class="fas fa-times mr-2"></i>
                        Hủy đơn đặt
                    </a>
                    {% endif %}
                    
                    <!-- Back Button -->
                    <a href="{% url 'booking:booking_list' %}" class="flex-1 bg-gray-200 text-gray-800 px-6 py-4 rounded-lg font-semibold hover:bg-gray-300 transition text-center">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Quay lại danh sách
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Help Section -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center p-6 bg-green-50 rounded-lg">
                <i class="fas fa-question-circle text-green-600 text-2xl mb-3"></i>
                <h3 class="font-semibold text-gray-900 mb-2">Cần hỗ trợ?</h3>
                <p class="text-sm text-gray-600">Liên hệ hotline để được hỗ trợ</p>
            </div>
            <div class="text-center p-6 bg-green-50 rounded-lg">
                <i class="fas fa-calendar-plus text-green-600 text-2xl mb-3"></i>
                <h3 class="font-semibold text-gray-900 mb-2">Đặt sân mới</h3>
                <p class="text-sm text-gray-600">Đặt thêm sân khác</p>
            </div>
            <div class="text-center p-6 bg-green-50 rounded-lg">
                <i class="fas fa-history text-green-600 text-2xl mb-3"></i>
                <h3 class="font-semibold text-gray-900 mb-2">Lịch sử đặt sân</h3>
                <p class="text-sm text-gray-600">Xem tất cả đơn đặt sân</p>
            </div>
        </div>
    </div>
</div>

<!-- CTA Section -->
<div class="bg-green-600 py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl font-bold text-white mb-4">Cần hỗ trợ thêm?</h2>
        <p class="text-xl text-green-100 mb-8">Liên hệ với chúng tôi để được tư vấn và hỗ trợ tốt nhất</p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <a href="tel:1900xxxx" class="inline-flex items-center justify-center px-8 py-4 bg-white text-green-600 hover:bg-green-50 font-semibold rounded-lg transition">
                <i class="fas fa-phone mr-2"></i>
                Gọi hotline
            </a>
            <a href="{% url 'booking:court_list' %}" class="inline-flex items-center justify-center px-8 py-4 bg-transparent border-2 border-white text-white hover:bg-white hover:text-green-600 font-semibold rounded-lg transition">
                <i class="fas fa-calendar-plus mr-2"></i>
                Đặt sân mới
            </a>
        </div>
    </div>
</div>
{% endblock %}